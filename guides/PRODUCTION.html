<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Authentication &amp; Authorisation" href="AUTH.html" /><link rel="prev" title="Federated Analysis" href="../simulation/FEDERATED_ANALYSIS.html" />

    <meta name="generator" content="sphinx-5.0.2, furo 2022.06.04.1"/>
        <title>Production Deployment - AusCAT documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=40978830699223671f4072448e654b5958f38b89" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">AusCAT  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">AusCAT  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../installation.html">Simulation Environment Installation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../host.html">Host Machine Setup</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../simulation/LOCAL_MACHINE.html">Local Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../simulation/NECTAR.html">NECTAR Virtual Machine Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../simulation/DOCKER_PORTAINER.html">Docker &amp; Portainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulation/SIMULATION.html">Simulation Environment Deployment</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../simulation/METRICS.html">Metric Computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../simulation/FEDERATED_ANALYSIS.html">Federated Analysis</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Production Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="AUTH.html">Authentication &amp; Authorisation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../components/TABULAR.html">Tabular Database</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../components/KEYDB.html">KeyDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/CATDB.html">CatDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/PGADMIN.html">PGAdmin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/PENTAHO.html">Pentaho</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../components/IMAGING.html">Imaging</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../components/dicom.html">DICOM</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/ORTHANC.html">Orthanc</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/CTP.html">Clinical Trial Processor</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../components/DASHBOARD.html">Dashboards</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../components/DATAAVAILABILITY.html">Data Availability</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../components/TIPS.html">Tips and Tricks</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../components/PORTAINER.html">Portainer: Tips and Tricks</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../guidelines/CODING.html">AusCAT Coding Guidelines</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="production-deployment">
<h1>Production Deployment<a class="headerlink" href="#production-deployment" title="Permalink to this heading">#</a></h1>
<p>This guide outlines the steps required to deploy an AusCAT node in a production setting (i.e. real patient data will be loaded in and anonymised in this environment). This guide assumes you have worked through the steps involved in setting up the <a class="reference internal" href="../simulation/SIMULATION.html"><span class="std std-doc">Simulation Environment</span></a>. This document provides guidance on additional considerations when deploying this in a production setting.</p>
<blockquote>
<div><p>Important: Throughout this process, you will be required to define secure passwords for various components of this AusCAT system. It is essential that choose secure passwords in a production environment! Consider using a <a class="reference external" href="https://my.norton.com/extspa/passwordmanager?path=pwd-gen">password generator</a> to generate secure passwords containing at least 16 characters.</p>
</div></blockquote>
<section id="infrastructure">
<h2>Infrastructure<a class="headerlink" href="#infrastructure" title="Permalink to this heading">#</a></h2>
<p>Each AusCAT production server should be installed on dedicated hardware located within a hospital/organisation or on a cloud service which has been configured by your IT department to be only accessible via your local corporate network. For a production system, two separate Virtual Machines (VM) are recommended. This guide assumes that two VMs with the following configuration are available for deployment:</p>
<section id="vm-1-keyvm">
<h3>VM 1: KeyVM<a class="headerlink" href="#vm-1-keyvm" title="Permalink to this heading">#</a></h3>
<p>This Virtual Machine will host the <a class="reference internal" href="../components/KEYDB.html"><span class="std std-doc">KeyDB</span></a> and related components which store and process <strong>identifiable</strong> patient data.</p>
<ul class="simple">
<li><p>Ubuntu 22.04 Operating System</p></li>
<li><p>2 vCPUs</p></li>
<li><p>8GB RAM</p></li>
<li><p>256GB Disk</p></li>
</ul>
</section>
<section id="vm-2-catvm">
<h3>VM 2: CatVM<a class="headerlink" href="#vm-2-catvm" title="Permalink to this heading">#</a></h3>
<p>This Virtual Machine will host the <a class="reference internal" href="../components/CATDB.html"><span class="std std-doc">CatDB</span></a> and related components which store and process <strong>anonymised</strong> patient data.</p>
<ul class="simple">
<li><p>Ubuntu 22.04 Operating System</p></li>
<li><p>4 vCPUs</p></li>
<li><p>16GB RAM</p></li>
<li><p>256GB disk to host operating system</p></li>
<li><p>4TB disk to store imaging data (this amount may vary depending on amount of imaging data available)</p></li>
</ul>
<blockquote>
<div><p>Note: While Docker can be deployed and run on Windows using Windows Subsystem for Linux, we currently do not have any documentation on installing AusCAT on this platform.</p>
</div></blockquote>
</section>
<section id="vm-setup">
<h3>VM Setup<a class="headerlink" href="#vm-setup" title="Permalink to this heading">#</a></h3>
<p>Ensure the following is setup and installed on <strong>both</strong> VMs prior to proceeding.</p>
<section id="docker-portainer">
<h4>Docker &amp; Portainer<a class="headerlink" href="#docker-portainer" title="Permalink to this heading">#</a></h4>
<p>Ensure the <a class="reference internal" href="../simulation/DOCKER_PORTAINER.html"><span class="std std-doc">Docker and Portainer</span></a> are installed on both VMs</p>
</section>
<section id="remote-desktop">
<h4>Remote Desktop<a class="headerlink" href="#remote-desktop" title="Permalink to this heading">#</a></h4>
<p>To interact with GUI tools, make sure remote desktop is installed and enabled on each VM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>xrdp
</pre></div>
</div>
</section>
<section id="configure-proxy-on-each-vm">
<h4>Configure Proxy on each VM<a class="headerlink" href="#configure-proxy-on-each-vm" title="Permalink to this heading">#</a></h4>
<p>Ensure that the Network Proxy is configured in all the appropraite places on each VM, including:</p>
<ul class="simple">
<li><p>Docker</p></li>
<li><p>Ubuntu’s apt package manager</p></li>
<li><p>Wget</p></li>
<li><p>Git</p></li>
<li><p>Firefox</p></li>
</ul>
</section>
<section id="create-a-shared-folder">
<h4>Create a shared folder<a class="headerlink" href="#create-a-shared-folder" title="Permalink to this heading">#</a></h4>
<p>So that all users can access the tools you need, create a shared folder in which applications will be installed in the following steps:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>/home/shared
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">777</span><span class="w"> </span>/home/shared
</pre></div>
</div>
</section>
</section>
<section id="password-management">
<h3>Password Management<a class="headerlink" href="#password-management" title="Permalink to this heading">#</a></h3>
<p>During the deployment process you will be required to define several secure passwords. It is recommended to make use of a password manager to store these passwords. You may consider using <a class="reference external" href="https://keepass.info/">KeePass</a>.</p>
</section>
</section>
<section id="keyvm-installation">
<h2>KeyVM Installation<a class="headerlink" href="#keyvm-installation" title="Permalink to this heading">#</a></h2>
<p>The following steps should be performed on the KeyVM.</p>
<section id="configure-log-file-directory">
<h3>Configure Log File Directory<a class="headerlink" href="#configure-log-file-directory" title="Permalink to this heading">#</a></h3>
<p>First make a directory in which to store log files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>/data/logs
</pre></div>
</div>
</section>
<section id="configure-keydb-secrets">
<h3>Configure KeyDB Secrets<a class="headerlink" href="#configure-keydb-secrets" title="Permalink to this heading">#</a></h3>
<p>Next configure the following secrets in Portainer. Be sure to assign secure passwords to <code class="docutils literal notranslate"><span class="pre">keydb_pass</span></code>, <code class="docutils literal notranslate"><span class="pre">keydb_ctp_pass</span></code> and <code class="docutils literal notranslate"><span class="pre">ctp_admin_pass</span></code>. As you assign these, be sure to store these passwords in your password manager.</p>
<ul class="simple">
<li><p>keydb_user</p></li>
<li><p>keydb_pass</p></li>
<li><p>keydb_ctp_pass</p></li>
<li><p>ctp_admin_pass</p></li>
</ul>
</section>
<section id="deploy-keyvm-docker-stack">
<h3>Deploy KeyVM Docker Stack<a class="headerlink" href="#deploy-keyvm-docker-stack" title="Permalink to this heading">#</a></h3>
<p>In portainer, create a new Docker Stack. Insert the contents of the KeyDB stack template found <a class="reference external" href="https://github.com/AustralianCancerDataNetwork/auscat_installation/blob/main/docker-compose-key.yml">here</a>.</p>
<p>Before deploying the stack, modify the PGAdmin login credentials by updating the environment variables for:</p>
<ul class="simple">
<li><p>PGADMIN_DEFAULT_EMAIL</p></li>
<li><p>PGADMIN_DEFAULT_PASSWORD</p></li>
</ul>
<p>Also update the log path folder voluem for CTP to:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data/logs:/logs</span>
</pre></div>
</div>
<p>You are now ready to deploy the stack.</p>
</section>
<section id="test-keyvm-deployment">
<h3>Test KeyVM Deployment<a class="headerlink" href="#test-keyvm-deployment" title="Permalink to this heading">#</a></h3>
<p>In a web browser, navigate to <code class="docutils literal notranslate"><span class="pre">http://[KEYVM-IP]:5050</span></code> and login to PGAdmin using the email address and password combination configured in the Docker stack.</p>
<p>In here, you will need to configure the connection to the KeyDB. Create a new connection and specify the following:</p>
<ul class="simple">
<li><p>Name: KeyDB</p></li>
<li><p>Host: <code class="docutils literal notranslate"><span class="pre">[KEYVM-IP]</span></code></p></li>
<li><p>Port: 5433</p></li>
<li><p>Username: <code class="docutils literal notranslate"><span class="pre">[keydb_user]</span></code> (configured as secret)</p></li>
<li><p>password: <code class="docutils literal notranslate"><span class="pre">[keydb_pass]</span></code> (configured as secret)</p></li>
</ul>
<p>You may also test out the web interface for CTP. Navigate to <code class="docutils literal notranslate"><span class="pre">http://[KEYVM-IP]:9090</span></code> and confirm you can access the CTP admin interface.</p>
</section>
<section id="pentaho-installation">
<h3>Pentaho Installation<a class="headerlink" href="#pentaho-installation" title="Permalink to this heading">#</a></h3>
<p>Instructions on installing and utilising Pentaho can be found <a class="reference external" href="https://github.com/AustralianCancerDataNetwork/auscatverse/blob/pentaho-docs/components/PENTAHO.md">here</a>. Ensure Pentaho is installed before proceeding to setting up the CatVM.</p>
</section>
</section>
<section id="catvm">
<h2>CatVM<a class="headerlink" href="#catvm" title="Permalink to this heading">#</a></h2>
<p>The following steps should be performed on the CatVM.</p>
<p>When deploying the CatVM, a large data disk should be available to host the imaging data. This may be the disk on which the operating system is installed, or it may need to be mounted, for example under <code class="docutils literal notranslate"><span class="pre">/mnt/data</span></code>.</p>
<section id="configure-catdb-secrets">
<h3>Configure CatDB Secrets<a class="headerlink" href="#configure-catdb-secrets" title="Permalink to this heading">#</a></h3>
<p>Next configure the following secrets in CatVM’s Portainer. Be sure to assign a secure password to <code class="docutils literal notranslate"><span class="pre">catdb_pass</span></code>. Also be sure to store this in your password manager.</p>
<ul class="simple">
<li><p>catdb_user</p></li>
<li><p>catdb_pass</p></li>
</ul>
<p>You should also add a secret to hold the Orthanc configuration. Create a secret named <code class="docutils literal notranslate"><span class="pre">orthanc.json</span></code> with the contents <a class="reference external" href="https://github.com/AustralianCancerDataNetwork/auscat_imaging/blob/main/orthanc/orthanc.json">found here</a> (making sure to set a secure username/password combination under registered users and storing these in your password manager):</p>
</section>
<section id="deploy-catvm-docker-stack">
<h3>Deploy CatVM Docker Stack<a class="headerlink" href="#deploy-catvm-docker-stack" title="Permalink to this heading">#</a></h3>
<p>In portainer, create a new Docker Stack. Insert the contents of the CatDB stack template found <a class="reference external" href="https://github.com/AustralianCancerDataNetwork/auscat_installation/blob/main/docker-compose-cat.yml">here</a>.</p>
<p>Before deploying the stack, modify the PGAdmin login credentials by updating the environment variables for:</p>
<ul class="simple">
<li><p>PGADMIN_DEFAULT_EMAIL</p></li>
<li><p>PGADMIN_DEFAULT_PASSWORD</p></li>
</ul>
<p>also update the Orthanc volume mapping to a location on the large data disk mounted (if this isn’t the operating system disk):</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/media/data/orthanc:/var/lib/orthanc/db</span>
</pre></div>
</div>
<p>You are now ready to deploy the stack.</p>
</section>
<section id="test-catvm-deployment">
<h3>Test CatVM Deployment<a class="headerlink" href="#test-catvm-deployment" title="Permalink to this heading">#</a></h3>
<p>In a web browser, navigate to <code class="docutils literal notranslate"><span class="pre">http://[CATVM-IP]:5050</span></code> and login to PGAdmin using the email address and password combination configured in the Docker stack. Create a connection to the CatDB using the following credentials:</p>
<ul class="simple">
<li><p>Name: CatDB</p></li>
<li><p>Host: <code class="docutils literal notranslate"><span class="pre">[CATVM-IP]</span></code></p></li>
<li><p>Port: 5434</p></li>
<li><p>Username: <code class="docutils literal notranslate"><span class="pre">[catdb_user]</span></code> (configured as secret)</p></li>
<li><p>Password: <code class="docutils literal notranslate"><span class="pre">[catdb_pass]</span></code> (configured as secret)</p></li>
</ul>
<p>You may also want to log into the Orthanc admin area by visiting <code class="docutils literal notranslate"><span class="pre">http://[CATVM-IP]:8042</span></code> and entering the credentials you specified in the <code class="docutils literal notranslate"><span class="pre">orthanc.json</span></code> secret.</p>
</section>
</section>
<section id="data-import">
<h2>Data Import<a class="headerlink" href="#data-import" title="Permalink to this heading">#</a></h2>
<section id="clinical-data">
<h3>Clinical Data<a class="headerlink" href="#clinical-data" title="Permalink to this heading">#</a></h3>
<p>On the KeyVM, setup the clinical data import pipelines in Pentaho. First clone the repository containing the Pentaho templates:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/home/shared
git<span class="w"> </span>clone<span class="w"> </span>git@github.com:AustralianCancerDataNetwork/auscat_etl_centres.git
</pre></div>
</div>
<p>Run Pentaho, and them import the appropriate <code class="docutils literal notranslate"><span class="pre">.kjb</span></code> files and confgured the connection to the OIS (MOSAIQ/ARIA) for your centre. Consult the <a class="reference external" href="https://github.com/AustralianCancerDataNetwork/auscatverse/blob/pentaho-docs/components/PENTAHO.md">Pentaho guide</a> for details on running Pentaho and configuring pipelines.</p>
</section>
<section id="imaging-data">
<h3>Imaging Data<a class="headerlink" href="#imaging-data" title="Permalink to this heading">#</a></h3>
<p>One initial clinical data has been imported, DICOM imaging data for those patients can be sent to the Orthanc running on the CatVM via the CTP for anonymisation. To achieve this, send the DICOM data to the following DICOM endpoint:</p>
<ul class="simple">
<li><p>Host: <code class="docutils literal notranslate"><span class="pre">[KEYVM-IP]</span></code></p></li>
<li><p>Port: 8104</p></li>
</ul>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this heading">#</a></h2>
<section id="a-container-is-failing-to-deploy">
<h3>A container is failing to deploy<a class="headerlink" href="#a-container-is-failing-to-deploy" title="Permalink to this heading">#</a></h3>
<p>Ensure that the image is being pulled properly. Sometimes a manual pull of an image can help resolve this. Navigate to <code class="docutils literal notranslate"><span class="pre">Images</span></code> in Portainer and pull the image which is failing to deploy from DockerHub. Once pulled, try to deploy the container in the stack again.</p>
</section>
<section id="authentication-error-when-logging-into-pgadmin">
<h3>Authentication error when logging into PGAdmin<a class="headerlink" href="#authentication-error-when-logging-into-pgadmin" title="Permalink to this heading">#</a></h3>
<p>PGAdmin may have issues with login if your password contains any special symbols (such as a $ sign). Change the password, remove the PGAdmin volume and redeploy the stack.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="AUTH.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Authentication &amp; Authorisation</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../simulation/FEDERATED_ANALYSIS.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Federated Analysis</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Ingham Medical Physics
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Production Deployment</a><ul>
<li><a class="reference internal" href="#infrastructure">Infrastructure</a><ul>
<li><a class="reference internal" href="#vm-1-keyvm">VM 1: KeyVM</a></li>
<li><a class="reference internal" href="#vm-2-catvm">VM 2: CatVM</a></li>
<li><a class="reference internal" href="#vm-setup">VM Setup</a><ul>
<li><a class="reference internal" href="#docker-portainer">Docker &amp; Portainer</a></li>
<li><a class="reference internal" href="#remote-desktop">Remote Desktop</a></li>
<li><a class="reference internal" href="#configure-proxy-on-each-vm">Configure Proxy on each VM</a></li>
<li><a class="reference internal" href="#create-a-shared-folder">Create a shared folder</a></li>
</ul>
</li>
<li><a class="reference internal" href="#password-management">Password Management</a></li>
</ul>
</li>
<li><a class="reference internal" href="#keyvm-installation">KeyVM Installation</a><ul>
<li><a class="reference internal" href="#configure-log-file-directory">Configure Log File Directory</a></li>
<li><a class="reference internal" href="#configure-keydb-secrets">Configure KeyDB Secrets</a></li>
<li><a class="reference internal" href="#deploy-keyvm-docker-stack">Deploy KeyVM Docker Stack</a></li>
<li><a class="reference internal" href="#test-keyvm-deployment">Test KeyVM Deployment</a></li>
<li><a class="reference internal" href="#pentaho-installation">Pentaho Installation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#catvm">CatVM</a><ul>
<li><a class="reference internal" href="#configure-catdb-secrets">Configure CatDB Secrets</a></li>
<li><a class="reference internal" href="#deploy-catvm-docker-stack">Deploy CatVM Docker Stack</a></li>
<li><a class="reference internal" href="#test-catvm-deployment">Test CatVM Deployment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-import">Data Import</a><ul>
<li><a class="reference internal" href="#clinical-data">Clinical Data</a></li>
<li><a class="reference internal" href="#imaging-data">Imaging Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#a-container-is-failing-to-deploy">A container is failing to deploy</a></li>
<li><a class="reference internal" href="#authentication-error-when-logging-into-pgadmin">Authentication error when logging into PGAdmin</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>